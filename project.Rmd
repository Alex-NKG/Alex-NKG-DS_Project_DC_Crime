---
title: "DC area criminal incident analysis"
author: "Yueyang Liu"
date: "2020/4/26"
output:
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = FALSE)
```

```{r include=FALSE}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(tidyverse)
library(lubridate)
library(plotly)
library(gganimate)
library(broom)
library(dplyr)
library(car)
library(MASS)
dc_crime<-read.csv("./dc_crimes_search_results.csv")
```


# 1.  Executive Summary
Our project is criminal cases analyze in the DC area, in the project we hope we can explore the relationship between criminal case numbers and other possible predictor variables. By this topic,  we hope to raise people’s awareness of public safety. Our analyses suggest that the number of criminal cases is associated with date and time, also the number is higher in the downtown area. However, our analyses were constrained by the small size of the data set(from 2018 to 2019) and we do not found the population distribution data in the DC area, in this case, we can not analyze the criminal rate in the area.


# 2. About this data
This date is published by Metropolitan Police Department, includes information of crime csaes happend in the DC area. Data are presented for 2018 to  Feb,2020. There are 29 variables in the data set. 
```{r}
head(dc_crime)
```

# 3. Initial Hypotheses and questions
## 1. The number of crimes will be positively associated with the hour(24-Hour Time format).

## 2. The number of crimes will be associated with the month.  

## 3. Is there are any area have higher number of crimes than others?  

## 4. Which kind of crime is happend most frequency of each month in the DC area?  
## 5. What is the tend of number of cirmes changes from 2018 to 2019 in the DC area? 

# 4. Tidy data
First of all, we get original data from the official website. Then we use 'lubridate' and 'tidyverse' packages to tidy our data and to get all the variables what we want.

```{r}
dc_crime %>% 
    mutate(REPORT_DAT=parse_datetime(as.character(dc_crime$REPORT_DAT),format = "%Y-%m-%dT%H:%M:%OSZ")) %>% 
    mutate(Month=month(REPORT_DAT)) %>% 
    mutate(Year=year(REPORT_DAT)) %>%
    mutate(Day=mday(REPORT_DAT)) %>%
    mutate(Hour=hour(REPORT_DAT)) %>% 
    #group_by(offense.text,Year,Month) %>% 
    mutate(Time=make_date(year = Year,month = Month)) %>% 
  filter(Year!=2020) %>% 
  dplyr::select(-NEIGHBORHOOD_CLUSTER,-CENSUS_TRACT,-offensegroup,-END_DATE,-YBLOCK,-WARD,-offensekey,-BID,-PSA,-`ucr.rank`,-BLOCK_GROUP,-VOTING_PRECINCT,-XBLOCK,BLOCK,-location)->tidy_dc
head(tidy_dc)
```
After those primal steps, we get time and total crime number so that we can analysis the relationship between them.
Next, after tidying the others data, we get district and sector which used to compared with the frequency of crime. The code as shown below.
Besides, for better visualization graphics, we also use shinny app. and here is our link:
http://ds.lyy.asia

```{r}
#crime number by sector
dc_crime %>% 
  group_by(sector) %>% 
  summarise(n=n()) %>% 
  filter(sector!='')->total_n 
head(total_n)
#crime number by sector and offense type
dc_crime %>% 
  group_by(sector,offense.text) %>% 
  summarise(n=n()) %>% 
  filter(sector!='') %>% 
  spread(key ="offense.text", value = "n") %>% 
  mutate(arson= replace_na(arson, 0))  ->split_n 
head(split_n)
```

# 5. Analysis, visualization models  

## 5.1 Trends in the number of crimes

we want to compare crime data for 2018 and 2019 from a big perspective. We select the offense group, the number of different types of crimes, the tend of different types of crimes.  
This table compares crime data in 2018 and 2019 in detail
```{r}
tidy_dc %>% 
  group_by(offense.text,Year) %>% 
  rename( Title = 'offense.text') %>% 
  ggplot( mapping=aes(x=fct_rev(fct_infreq(Title)),fill=as.factor(Year)))+
  geom_bar(stat="count",width=0.7,position='dodge')+
  labs(x="",y="Total Number",fill = "Year") +
  theme_bw()+
  geom_text(stat='count',aes(label=..count..), color="black", size=3.5,position=position_dodge(width=1),vjust=0.7)+
  coord_flip()
```

Overall,some kinds crime's number increased slightly from 2018 to 2019, including property losses and violent incidents.  
Specifically,the rubbery and theft cases increased from 2018 to 2019, while the other kind of offense number decreased.  
According to this estimate, we may say the public safety situation is improving.  

## 5.2 Explore the hypothese：crimes number will be associated with the month

We draw a scatter plot to explore the relationship between crime number and months.
```{r}
tidy_dc %>% 
  group_by(Year,Month) %>% 
  summarise(Total=n()) %>% 
  #mutate(Time=make_date(year = Year,month = Month)) %>% 
  ggplot(mapping = aes(x = as.factor(Month),y = Total)) + 
    geom_point() + 
    theme_bw() + 
    xlab("Time") + 
    ylab("Total Number") + 
    ggtitle("Crime number VS Time") + 
  facet_wrap(~ Year)
```
According to the plot, the crime number will gradually increase from Feb and reach the peak point at August and we should notice the Jan's data may regard as the outlier.  
First, use the lm() model to fit the data,  
$Y_i= \beta_0+\beta_1X_{1}$  
$\beta_0$ is the intercept on Y.  
$\beta_1$ is the effect on Y(Total crime cases) for changes in X(month) given the other variables in the model.  
```{r}
tidy_dc %>% 
  group_by(Year,Month) %>% 
  summarise(Total=n())->mvt
crime_mn=lm(Total~Month,data=mvt)
summary(crime_mn)
```
We see the p value is 6.732e-05, but the R-squared is only about 0.5217 which not fit the model very well,we still need to optmize this model.  
```{r}
#outlier test
outlierTest(crime_mn)
```
According to the outlier test we can confirm that Jan's data is a outlier data.  
Since we see a covered shape between month and crime number, we decide do some transform on responsiable value y.  
To find the best $\lambda$, we apply the Box-Cox transformation of responses Y:
```{r}
boxcox(crime_mn,lambda=seq(1,6,0.05))
```
according to the plot,we set $\lambda=3.2$ 
```{r}
r=mvt$Total^3.1 
new_crime=lm(r~Month,data=mvt)
summary(new_crime)
```
The R-squared is 0.5699,which is better than previous one.
Now the model is :$Y^{3.1}=2.258e^{10}+4.283e^{09}X$  
We also tired a piecewise function to fit the 2 side of the peak point.  
```{r}
stage_fit<-lm (mvt$Total~  I(mvt$Month<=7) + 
                 I((mvt$Month<=7)*mvt$Month)+
                 I(mvt$Month>7) + 
                 I((mvt$Month>7)*mvt$Month))
summary(stage_fit)
qplot(mvt$Month,mvt$Total)+
  geom_line(aes(mvt$Month, fitted.values(stage_fit)),colour=3)

```
In the piecewise function model, the R-squared value is 0.7139, and the P value is small, we can accept that there is a piecewise linear relationship brtween momth and crime number.  




## 5.3 Explore the hypothese：Crime number may have negative association  with hour during the midnight

Residents can be reminded that there are more thieves during that time, and people who are abnormal in behavior should be noted.

Other types of crime are also likely to happen in the evening and midnight, so people should be reminded to pay attention to keeping their personal belongings while hang out during this time, and see the suspicious persons in a timely manner to avoid robbery. Most importantly, if suspicious phenomena are found find a safe place to call the police.  
We select the day time belong to midnight:
```{r}
tidy_dc %>% 
  filter(SHIFT=="midnight") %>% 
  group_by(Time,Hour) %>%
  na.omit() %>% 
  summarise(n=n())->time_n
time_n %>% 
   ggplot(mapping = aes(x = as.factor(Hour),y = n)) + 
    geom_boxplot() + 
    theme_bw() + 
    xlab("Time") + 
    ylab("Total Number") + 
    ggtitle("Crime number in day")
```
```{r}
tm<-lm(n~as.factor(Hour),data = time_n)
summary(tm)
```
Through analysis we found that crime is more frequent at night. Thus, we want to use regression model to show their relationship.
So we are wondering the if the crime number is related with time(day, evening, midnight).
Here is the model:
$Y_i= \beta_0+\beta_1X_{1i}+\varepsilon_i$
$\beta_0$ is the intercept on Y.
$\beta_1$ is the effect on Y(Total crime cases) for changes in X1(Time) given the other variables in the model.
$\varepsilon_i$ is the noise on this model.
According to the p-value is below the 0.05 and the R-squared is 0.6586, we can reject the  null hypothesis. Those varibles do have linear relationship.



## 5.4 crime distrimbutuon 
```{r}
tidy_dc %>%
  filter(Year==2018) %>% 
  group_by(Month,offense.text) %>% 
  summarise(n=n()) %>% 
  ggplot(aes(x="", y=n, fill=offense.text))+
  geom_bar(width = 1, stat = "identity")+
 coord_polar("y", start=0)+
  facet_wrap(~ Month)
```
```{r}
tidy_dc %>%
  filter(Year==2019) %>% 
  group_by(Month,offense.text) %>% 
  summarise(n=n()) %>% 
  ggplot(aes(x="", y=n, fill=offense.text))+
  geom_bar(width = 1, stat = "identity")+
 coord_polar("y", start=0)+
  facet_wrap(~ Month)
```


# Conclusion
Through research, it is found that the probability of crime occurring at night is higher,and there is linear relationship with time. In addition, during the holiday, the frequency of crime changes greatly, and the relationship between them is verified by t test. Finally, the crime situation in the central DC Higher than the surrounding, and they do have linear relationship.

Through this project, we have shown the tend of crime rate. The crime frequents at the end of the year and at night. Compared with the citywide of DC, city center crime is more serious. Besides, through this project, we want to show people that Building on DC’s public safety improvements will take more than policing alone, we need a holistic approach that involves social services, the police, nonprofits, and residents working together, only through collaboration can the city build safer communities—creating the social supports, stability, and opportunities that will bring down even the most persistent pockets of violent crime. 

# limitation
We have only shown the data for 2018 and 2019. Perhaps the scope of the data set should be expanded, which is more convincing. In addition, as a non-professional, there may be some analytical bias.
We have not been able to find data on the population distribution in each area, we cannot study the relationship between the number of crimes and the number of people, and we cannot determine the crime rate.

# Reference
https://mpdc.dc.gov/page/district-crime-data-glance

Moore,H.M., & Trojanowicz,C.R.(1988). Policing and the Fear of Crime. U.S. Department of Justice. No.3
https://www.ncjrs.gov/pdffiles1/nij/111459.pdf

# Session Info
```{r}
sessionInfo()
```

